---
import Layout from "@/layouts/Layout.astro";
import { getCollection } from "astro:content";
import { Image } from "astro:assets";

import { AspectRatio } from "@/components/ui/aspect-ratio";

const allPosts = (await getCollection("posts"))
  .sort((a, b) => b.data.pubDate.getTime() - a.data.pubDate.getTime())
  .filter(post => post.data.published);

const featuredPost = allPosts.find(post => post.data.featured)!;
---

<Layout meta={{ title: 'Home', description: 'Welcome to the home page of Aerostack2 for ROS2 Jazzy' }}>
    <main class="flex flex-col mx-6 min-h-screen gap-6">
        <!-- Featured post section -->
        <section id="featured-video" class="hover:bg-gray-300/20 dark:hover:bg-gray-700/20 p-2 rounded-2xl h-full">
            <a href={`/posts/${featuredPost.id}`}>
                <div class="flex h-full">
                    <div class="flex flex-col pr-4 gap-6">
                        <div class="flex flex-col gap-4">
                            <h1 class="text-4xl">{featuredPost.data.title}</h1>
                            <div class="flex gap-5">
                                <span>By {featuredPost.data.author}</span>
                                <span class="opacity-70">
                                    {featuredPost.data.pubDate.toLocaleString("default", {
                                        month: "long",
                                        year: "numeric",
                                        day: "numeric",
                                    })}
                                </span>
                            </div>
                        </div>
                        <span class="text-sm opacity-70">{featuredPost.data.description}</span>
                        <div class="flex gap-2 justify-self-end">
                            {featuredPost.data.tags.map(tag => <span class="bg-neutral-700 text-xs text-white px-2 py-1 rounded">{tag}</span>)}
                        </div>
                    </div>
                    <div class="w-full max-w-4xl mx-auto relative">
                        <AspectRatio ratio={16 / 9} className="rounded-lg overflow-hidden border border-gray-500/30 shadow-lg">
                            <Image
                                src={featuredPost.data.image}
                                alt={featuredPost.data.title}
                                width={1200}
                                height={675}
                                class="object-cover w-full h-full"
                            />
                        </AspectRatio>
                    </div>
                </div>
            </a>
        </section>

        <!-- Latest posts section -->
        <section id="latest-posts" class="mt-12">
            <div class="grid grid-cols-3 gap-6">
                {allPosts
                  .filter(post => post.id != featuredPost.id)
                  .slice(0, 12)
                  .map(post => (
                      <a href={`/posts/${post.id}`} class="hover:bg-neutral-700/10 dark:hover:bg-neutral-300/10 p-4 rounded-md">
                          <div class="flex flex-col gap-3">
                              <AspectRatio ratio={16 / 9} className="rounded-lg overflow-hidden border border-gray-500/30 shadow-lg">
                                  <Image
                                      src={post.data.image}
                                      alt={post.data.title}
                                      width={800}
                                      height={450}
                                      class="object-cover w-full h-full"
                                  />
                              </AspectRatio>
                              <h3 class="text-lg font-semibold">{post.data.title}</h3>
                              <p class="text-sm opacity-70">{post.data.author}</p>
                              <div class="flex gap-2 mt-6">
                                  {post.data.tags.map(tag => <span class="bg-neutral-700 text-xs text-white px-2 py-1 rounded">{tag}</span>)}
                              </div>
                          </div>
                      </a>
                  ))
                }
            </div>
        </section>

        <!-- Archive section -->
        <section id="archive" class="mb-20">
            <h2 class="text-3xl mb-8">Archive</h2>
            {allPosts
              .filter(post => post.id != featuredPost.id)
              .slice(12)
              .map(post => (
                  <a href={`/posts/${post.id}`} class="block hover:bg-neutral-700/20 dark:hover:bg-neutral-300/20 p-4 rounded-md border-b">
                      <div class="grid grid-cols-[150px_auto_auto_auto_auto] gap-8 items-center">
                          <AspectRatio ratio={16 / 9} className="rounded-lg overflow-hidden border border-gray-500/30 shadow-lg">
                              <Image
                                  src={post.data.image}
                                  alt={post.data.title}
                                  width={300}
                                  height={169}
                                  class="object-cover w-full h-full"
                              />
                          </AspectRatio>
                          <span>{post.data.title}</span>
                          <div class="flex gap-2 items-center justify-center">
                              {post.data.tags.map(tag => <span class="bg-neutral-700 text-xs text-white px-2 py-1 rounded">{tag}</span>)}
                          </div>
                          <span class="text-center">{post.data.author}</span>
                          <span class="text-center">
                              {post.data.pubDate.toLocaleString("default", {
                                  month: "long",
                                  year: "numeric",
                                  day: "numeric",
                              })}
                          </span>
                      </div>
                  </a>
              ))
            }
        </section>
    </main>
</Layout>
