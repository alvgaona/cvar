---
import { getCollection, render } from "astro:content";
import { Image } from "astro:assets";
import BlogLayout from "@/layouts/BlogLayout.astro";
import Prose from "@/components/Prose.astro";
import { AspectRatio } from "@/components/ui/aspect-ratio";
import { Dot } from 'lucide-react'

export async function getStaticPaths() {
    const allPosts = await getCollection("posts");

    return allPosts
        .filter((post) => post.data.published)
        .map((post) => ({
            params: { slug: post.id },
            props: { post },
        }));
}

const { post } = Astro.props;
const { Content } = await render(post);
const frontmatter = post.data;
---

<BlogLayout frontmatter={frontmatter}>
    <Prose>
        <h1>{frontmatter.title}</h1>
        <div class="flex mb-6 items-center text-md">
            <span>{frontmatter.author}</span>
            <Dot />
            <span>
                {
                    frontmatter.pubDate.toLocaleString("default", {
                        month: "long",
                        year: "numeric",
                        day: "numeric",
                    })
                }
            </span>
        </div>
        <div class="w-full max-w-5xl mx-auto relative mb-10">
            <AspectRatio ratio={16 / 9} className="rounded-lg overflow-hidden border border-gray-500/30 shadow-lg">
                <Image
                    src={frontmatter.image}
                    alt={frontmatter.title}
                    width={1400}
                    height={788}
                    class="object-cover w-full h-full"
                />
            </AspectRatio>
        </div>
        <div class="w-full max-w-2xl mx-auto relative">
            <Content />
        </div>
    </Prose>
</BlogLayout>
